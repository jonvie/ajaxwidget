"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function i(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),jv;(function(jv){var ajaxWidget=function(_super){function ajaxWidget(t,e,a,i,r){void 0===t&&(t="loading"),void 0===e&&(e=!0),void 0===a&&(a=500),void 0===i&&(i=500),void 0===r&&(r="http://static.xct.cn/sucai/loading.gif");var o=_super.call(this,t,e,a,i,r)||this;return o.widgetRootPath="/App_Addins/widgets/",o.areaVars=void 0,o}return __extends(ajaxWidget,_super),ajaxWidget.prototype.bulidWidgetAreas=function(t,e,a){void 0===e&&(e=""),void 0===a&&(a="/App_Addins/widgets/"),null!=a&&""!==a&&(ajaxWidget.prototype.widgetRootPath=a),ajaxWidget.prototype.areaVars=t,this.listenWidgetAreas(e)},ajaxWidget.prototype.loadAreaWidget=function(t,e,a){var i=0;"string"==typeof t?$.getJSON(t,function(t){t.forEach(function(t){ajaxWidget.prototype.rendWidgetItem(e,t,a,i),i++})}):t.forEach(function(t){ajaxWidget.prototype.rendWidgetItem(e,t,a,i),i++})},ajaxWidget.prototype.rendWidgetItem=function(t,e,a,i){void 0===i&&(i=0);var r=t.attr("widget_area")+"_"+e.Name+"_tmpl"+e.TmplIndex+"_"+i,o=$('<div id="'+r+'"  widget_name="'+e.Name+'" '+a+"></div>");t.append(o);var n=ajaxWidget.prototype.widgetRootPath+"widget."+e.Name+"/widget.config.json",d=ajaxWidget.prototype.widgetRootPath+"widget."+e.Name+"/widget.tmpl.html";void 0!==e.Config&&null!==e.Config&&""!==e.Config&&(n=e.Config),void 0!==e.Tmpl&&null!==e.Tmpl&&""!==e.Tmpl&&(d=e.Tmpl),$.getJSON(n,function(t){var a=$("<code></code>"),i="";$.get(d,function(n){var d=a.html(n).find("tmpl").eq(e.TmplIndex);i=d.html(),Object.keys(ajaxWidget.prototype.areaVars).forEach(function(t){i=i.replace("[%="+t+"%]".toLowerCase(),ajaxWidget.prototype.areaVars[t].toLowerCase())});var g=t.BaseDataUrl;void 0!==e.DataUrl&&null!==e.DataUrl&&""!==e.DataUrl&&(g=e.DataUrl),void 0!==d.attr("url")&&null!==d.attr("url")&&(g=d.attr("url")),""===g||null==g?o.html(i):(Object.keys(ajaxWidget.prototype.areaVars).forEach(function(t){g=g.toLowerCase().replace("{"+t+"}".toLowerCase(),ajaxWidget.prototype.areaVars[t].toLowerCase())}),ajaxWidget.prototype.reqTmpl({type:"get",url:g,dataType:"json",success:function(){},error:function(){o.html("widget数据加载出错！"),ajaxWidget.prototype.fadeOut()}},i,"#"+r))})})},ajaxWidget.prototype.listenWidgetAreas=function(attr){var areas="";$("[widget_area]").each(function(){var areaName=$(this).attr("widget_area");if(null!=areaName&&""!==areaName){$.inArray(areaName,areas.split(";"))>-1&&console.warn("重复定义了widget_area区域 ："+areaName+"，重复的定义可能引起未知异常！");var areaSetting=$(this).attr("widget_area_setting"),widgetItems=$(this).attr("widget_area_items"),obj=$(this);null!=widgetItems&&""!==widgetItems&&(areaSetting=eval(widgetItems)),ajaxWidget.prototype.loadAreaWidget(areaSetting,obj,attr),areas+=areaName+";"}})},ajaxWidget}(jv.ajaxView);jv.ajaxWidget=ajaxWidget})(jv||(jv={}));